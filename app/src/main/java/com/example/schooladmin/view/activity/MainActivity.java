package com.example.schooladmin.view.activity;import androidx.appcompat.app.AppCompatActivity;import androidx.appcompat.app.AppCompatDelegate;import android.app.ProgressDialog;import android.content.Intent;import android.content.SharedPreferences;import android.os.AsyncTask;import android.os.Bundle;import android.view.View;import android.view.animation.Animation;import android.view.animation.AnimationUtils;import android.widget.Button;import android.widget.CheckBox;import android.widget.EditText;import android.widget.RelativeLayout;import android.widget.TextView;import android.widget.Toast;import com.example.schooladmin.R;import com.example.schooladmin.connectdb.ConnectDB;import com.example.schooladmin.view.dialog.AdminCreateAccountBottomSheet;import com.google.android.material.snackbar.Snackbar;import java.sql.Connection;import java.sql.ResultSet;import java.sql.ResultSetMetaData;import java.sql.Statement;public class MainActivity extends AppCompatActivity {    private Animation topAnimation;    private RelativeLayout layoutSingIn;    private EditText edtLogInName;    private EditText edtLogInpassword;    private CheckBox checkboxLogInRemeberME;    private Button btnLogInSingIn;    private TextView txtLogInCreateAcount;    private ProgressDialog progressDialog;    private SharedPreferences sharedPreferences;    private AdminCreateAccountBottomSheet adminCreateAccountBottomSheet;    private ConnectDB connectDB;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate( savedInstanceState );        AppCompatDelegate.setDefaultNightMode( AppCompatDelegate.MODE_NIGHT_YES );        setContentView( R.layout.activity_main );        //for remeber me        sharedPreferences = getSharedPreferences( "remeberME", MODE_PRIVATE );        if (sharedPreferences.getBoolean( "remeberME", false )) {            startActivity( new Intent( MainActivity.this, HomeActivity.class ) );            finish();        }        //animation for ui login        topAnimation = AnimationUtils.loadAnimation( this, R.anim.top_animtion );        layoutSingIn = findViewById( R.id.layoutSingIn );        layoutSingIn.setAnimation( topAnimation );        connectDB = new ConnectDB();        progressDialog = new ProgressDialog( this );        //process Login        edtLogInName = findViewById( R.id.edtLogInName );        edtLogInpassword = findViewById( R.id.edtLogInpassword );        btnLogInSingIn = findViewById( R.id.btnLogInSingIn );        txtLogInCreateAcount = findViewById( R.id.txtLogInCreateAcount );        checkboxLogInRemeberME = findViewById( R.id.checkboxLogInRemeberME );        txtLogInCreateAcount.setOnClickListener( new View.OnClickListener() {            @Override            public void onClick(View view) {                adminCreateAccountBottomSheet = new AdminCreateAccountBottomSheet();                adminCreateAccountBottomSheet.show( getSupportFragmentManager(), "AdminCreateAccountBottomSheet" );            }        } );        btnLogInSingIn.setOnClickListener( new View.OnClickListener() {            @Override            public void onClick(View view) {                String name = edtLogInName.getText().toString().trim();                String password = edtLogInpassword.getText().toString().trim();                if (name.equals( "" ) || password.equals( "" )) {                    Toast.makeText( MainActivity.this, "Please fill all record and agine", Toast.LENGTH_SHORT ).show();                    return;                }                if (checkboxLogInRemeberME.isChecked()) {                    sharedPreferences = getSharedPreferences( "remeberME", MODE_PRIVATE );                    SharedPreferences.Editor editor = sharedPreferences.edit();                    editor.putBoolean( "remeberME", true );                    editor.commit();                }                logIN();            }        } );    }    public void logIN() {        new TaskSelectAdmin().execute( "" );    }    //region Login    public class TaskSelectAdmin extends AsyncTask<String, String, Integer> {        String namestr = edtLogInName.getText().toString();        String passwordstr = edtLogInpassword.getText().toString();        String state = "";        boolean isSuccess = false;        String returnName = "";        String returnPassword = "";        int adminID;        @Override        protected void onPreExecute() {            progressDialog.setMessage( "Loading..." );            progressDialog.show();        }        @Override        protected Integer doInBackground(String... strings) {            try {                Connection connection = connectDB.CONN();                if (connection == null) {                    Snackbar snackbar = Snackbar.make( findViewById( R.id.layoutSingIn ),                            "Please check your internet connection", Snackbar.LENGTH_LONG );                    snackbar.setAction( "RETRY", new View.OnClickListener() {                        @Override                        public void onClick(View view) {                        }                    } );                    snackbar.show();                } else {                    String queryUserID = "select id , name , password from admin" +                            " where ( name='" + namestr + "') and (password='" + passwordstr + "')";                    Statement stmt1 = connection.createStatement();                    ResultSet resultSet = stmt1.executeQuery( queryUserID );                    ResultSetMetaData resultSetMetaData = resultSet.getMetaData();                    while (resultSet.next()) {                        adminID = resultSet.getInt( 1 );                        returnName = resultSet.getNString( 2 );                        returnPassword = resultSet.getNString( 3 );                    }                    if (returnName.equals( "" ) || returnPassword.equals( "" )) {                        Snackbar snackbar = Snackbar.make( findViewById( R.id.layoutSingIn ),                                "Name or Password is Wrong", Snackbar.LENGTH_LONG );                        snackbar.setAction( "RETRY", new View.OnClickListener() {                            @Override                            public void onClick(View view) {                                edtLogInName.setText( "" );                                edtLogInpassword.setText( "" );                            }                        } );                        snackbar.show();                        isSuccess = false;                    } else {                        isSuccess = true;                    }                }            } catch (Exception ex) {                isSuccess = false;                state = "Exceptions" + ex;            }            return adminID;        }        @Override        protected void onPostExecute(Integer adminID) {            if (isSuccess) {                sharedPreferences = getSharedPreferences( "adminID", MODE_PRIVATE );                SharedPreferences.Editor editor = sharedPreferences.edit();                editor.putInt( "adminID", adminID );                editor.commit();                startActivity( new Intent( MainActivity.this, HomeActivity.class ) );                finish();            }            progressDialog.hide();        }    }    ///endregion    public void finshActivity() {        finish();    }}